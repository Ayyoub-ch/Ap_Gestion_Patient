<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Administratif{% endblock %}</title>
        <link rel="icon" href="/img/logo/logo-icone.ico" type="image/x-icon">
        
        <meta name="turbo-cache-control" content="no-cache">
        
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        
        {% block stylesheets %}
        {% endblock %}
    </head>
    <body data-turbo="false">
        {% include 'inc/header.html.twig' %}

        <main>
            {% block body %}{% endblock %}
        </main>

        {% include 'inc/footer.html.twig' %}
        
        <!-- Bootstrap JS avec Popper.js inclus (bundle) -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        
        <!-- Initialisation des dropdowns Bootstrap (avant Stimulus pour éviter les conflits) -->
        <script>
            // Fonction d'initialisation des dropdowns
            function initBootstrapDropdowns() {
                if (typeof bootstrap !== 'undefined') {
                    document.querySelectorAll('[data-bs-toggle="dropdown"]').forEach(function(element) {
                        // Détruire l'instance existante si elle existe
                        const existingInstance = bootstrap.Dropdown.getInstance(element);
                        if (existingInstance) {
                            existingInstance.dispose();
                        }
                        // Créer une nouvelle instance
                        new bootstrap.Dropdown(element, { autoClose: true });
                    });
                }
            }
            
            // Initialisation au chargement de la page
            document.addEventListener('DOMContentLoaded', initBootstrapDropdowns);
            
            // Réinitialisation après navigation Turbo (si Turbo est actif)
            document.addEventListener('turbo:load', initBootstrapDropdowns);
            document.addEventListener('turbo:render', initBootstrapDropdowns);
            
            // Nettoyage avant mise en cache Turbo
            document.addEventListener('turbo:before-cache', function() {
                document.querySelectorAll('.dropdown-menu.show, .dropdown.show').forEach(function(el) {
                    el.classList.remove('show');
                });
            });
        </script>
        
        {% block javascripts %}
            {% block importmap %}{{ importmap('app') }}{% endblock %}
        {% endblock %}
    </body>
</html>
